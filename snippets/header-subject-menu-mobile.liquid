{% comment %}
  Renders a mobile megamenu for "Shop By Subject" collections.
{% endcomment %}

{%- liquid
  assign by_subject = 'sections.header.custom_menu.by_subject' | t
-%}

<details id="Details-menu-drawer-subjects">
  <summary
    id="HeaderDrawer-subjects"
    class="menu-drawer__menu-item link link--text focus-inset"
  >
    {{ by_subject }}
    <span class="svg-wrapper">
      {{- 'icon-arrow.svg' | inline_asset_content -}}
    </span>
    <span class="svg-wrapper">
      {{- 'icon-caret.svg' | inline_asset_content -}}
    </span>
  </summary>
  <div
    id="link-subjects"
    class="menu-drawer__submenu has-submenu gradient motion-reduce"
    tabindex="-1"
  >
    <div class="menu-drawer__inner-submenu">
      <button class="menu-drawer__close-button link link--text focus-inset" aria-expanded="true">
        <span class="svg-wrapper">
          {{- 'icon-arrow.svg' | inline_asset_content -}}
        </span>
        {{ by_subject }}
      </button>
      <ul class="menu-drawer__menu list-menu" role="list" tabindex="-1">
        {%- assign subject_count = 0 -%}
        {%- for collection in collections -%}
          {%- if collection.metafields.collection.is_nav == true
            and collection.metafields.collection.by_subject == true
          -%}
            {%- assign subject_count = subject_count | plus: 1 -%}
            <li>
              <a
                href="{{ collection.url }}"
                class="menu-drawer__menu-item link link--text list-menu__item focus-inset{% if collection.current %} menu-drawer__menu-item--active{% endif %}"
                {% if collection.current %}
                  aria-current="page"
                {% endif %}
              >
                {{ collection.title | escape }}
              </a>
            </li>
          {%- endif -%}
        {%- endfor -%}
        {%- if subject_count > 30 -%}
          <li>
            <a
              href="/collections/subjects"
              class="menu-drawer__menu-item link link--text list-menu__item focus-inset custom-menu-cta"
            >
              View All Subjects
              <span class="custom-menu-cta-count">{{ subject_count | minus: 30 }}+</span>
            </a>
          </li>
        {%- endif -%}
      </ul>

      <!-- Featured Subject Collections -->
      <div class="menu-drawer__featured">
        <h3 class="menu-drawer__featured-title">Featured Subjects</h3>
        <div class="menu-drawer__featured-grid">
          {%- for collection in collections -%}
            {%- if collection.metafields.collection.is_nav == true
              and collection.metafields.collection.is_featured == true
            -%}
              <div class="menu-drawer__featured-item">
                <a href="{{ collection.url }}" class="menu-drawer__featured-link">
                  {%- if collection.image -%}
                    <img
                      src="{{ collection.image | image_url: width: 200 }}"
                      alt="{{ collection.title | escape }}"
                      class="menu-drawer__featured-image"
                      loading="lazy"
                      width="200"
                      height="160"
                    >
                  {%- endif -%}
                  <span class="menu-drawer__featured-title">{{ collection.title | escape }}</span>
                </a>
              </div>
            {%- endif -%}
          {%- endfor -%}
        </div>
      </div>
    </div>
  </div>
</details>
