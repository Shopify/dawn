{%- assign rk_resource_id_similar = similar_article.id | downcase -%}
{%- assign rk_mf_similar = similar_article.metafields.recipekit[rk_resource_id_similar] -%}
<div class="recipekit-card-outer">
  <a href="{{ similar_article.url }}" class="recipekit-card-link" aria-label="{{ similar_article.title | escape }}">
    <div class="recipekit-card">
      <div class="recipekit-card-image-wrapper">
        {%- if rk_mf_similar and rk_mf_similar.recipe_image != blank -%}
          {%- assign image_url = rk_mf_similar.recipe_image -%}
          {%- if image_url contains 'cloudinary.com' -%}
            {%- assign rk_last_url = image_url | split: 'upload/' -%}
            {%- assign card_image = rk_last_url[1]
              | prepend: 'https://res.cloudinary.com/hsxfx8igq/image/upload/t_1x1_recipe_image,f_auto/'
            -%}
          {%- elsif image_url contains 'backblazeb2.com' -%}
            {%- assign rk_last_url = image_url | split: 'backblazeb2.com/file/recipekit-bucket/' -%}
            {%- assign card_image = 'https://images.getrecipekit.com/'
              | append: rk_last_url[1]
              | append: '?aspect_ratio=1:1&quality=90&'
            -%}
          {%- elsif image_url contains 'cdn.shopify.com' -%}
            {%- assign card_image = image_url | append: '&width=300&height=300' -%}
          {%- else -%}
            {%- assign card_image = image_url -%}
          {%- endif -%}
          <img
            class="recipekit-card-image"
            src="{{ card_image }}"
            alt="{{ similar_article.title | escape }}"
            loading="lazy"
            width="300"
            height="300"
          >
        {%- elsif similar_article.image -%}
          <img
            class="recipekit-card-image"
            src="{{ similar_article.image | img_url: width: 300, height: 300, crop: 'center' }}"
            alt="{{ similar_article.title | escape }}"
            loading="lazy"
            width="300"
            height="300"
          >
        {%- else -%}
          <svg
            class="placeholder-svg recipekit-card-image"
            width="300"
            height="300"
            viewBox="0 0 300 300"
            xmlns="http://www.w3.org/2000/svg"
          >
            <rect width="300" height="300" style="fill: #f0f0f0;"/><text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" font-family="sans-serif" font-size="20px" fill="#aaa">No Image</text>
          </svg>
        {%- endif -%}
        {%- if rk_mf_similar and rk_mf_similar.prep_time != blank -%}
          <span class="recipekit-prep-time">{{ rk_mf_similar.prep_time }}</span>
        {%- endif -%}
      </div>
    </div>
  </a>
  <div class="recipekit-card-meta">
    <a href="{{ similar_article.url }}" class="recipekit-card-title-link">
      <div class="recipekit-card-title">{{ similar_article.title }}</div>
    </a>
  </div>
</div>
