<template>
  <div class="vue-step-wizard">
    <div class="step-header">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 250 250">
        <g transform="matrix(0.625,0,0,0.625,0,0)">
          <g transform="matrix(2,0,0,2,0,0)">
            <defs>

            </defs>
            <ellipse
                class="a"
                cx="100.22"
                cy="182.688"
                rx="94.78"
                ry="4.652"
            ></ellipse>
            <circle class="b" cx="42.652" cy="181.728" r=".628"></circle>
            <path
                class="b"
                d="M28.391 181.769a.629.629 0 1 1-.628.629.628.628 0 0 1 .628-.629z"
            ></path>
            <circle class="b" cx="38.203" cy="184.454" r=".628"></circle>
            <circle class="b" cx="71.916" cy="181.728" r=".628"></circle>
            <circle class="b" cx="52.676" cy="181.728" r=".628"></circle>
            <circle class="b" cx="63.963" cy="184.355" r=".628"></circle>
            <circle class="b" cx="110.203" cy="181.027" r=".628"></circle>
            <path
                class="b"
                d="M101.409 183.2a.629.629 0 1 1-.629.628.628.628 0 0 1 .629-.628zm17.479-167.35c-1.723-.743-.933-.534-30.287-.534l.239-1.739a.821.821 0 0 0-.918-.917H39.88a1.032 1.032 0 0 0-.9 1.223l.274 1.433c-9.811-.011-19.634-.1-29.446 0a4.635 4.635 0 0 0-4.786 5.118c.013.143 9.12 69.931 9.163 70.121a8.061 8.061 0 0 0 8.063 6.853c1.2.011 13.315 0 13.315 0-1.952 12.1-5.337 23.907-8.483 35.738-2.876 10.835-11.608 43.884-13.124 49.568a.4.4 0 0 0 .769.213C31.277 121 34.4 109.726 36.37 97.408h2.985l.337 1.776a.918.918 0 0 0 .9.747h46.79a.922.922 0 0 0 .913-.794l.233-1.729H98.4c3.04 19.025 11.926 46.944 21.555 82.861a.4.4 0 0 0 .768-.213c-8.413-31.441-18.36-63.067-21.518-82.653 13.189 0 12.395.034 13.217-.078a8.071 8.071 0 0 0 6.868-7.735c.763-12.994 3.395-64.821 3.494-66.731.159-2.949-1.009-5.759-3.896-7.009zm3.136 6.313c0 .158-3.5 67-3.51 67.162-.207 3.992-3.011 7.195-7.159 7.284-2.61.055-.1 0-22.712 0l.2-1.475a.821.821 0 0 0-.919-.916H39.88a1.032 1.032 0 0 0-.9 1.223l.222 1.183c-13.036.161-16.58-.015-16.705-.015a7.335 7.335 0 0 1-7.544-6.266C13.5 79.186 7.241 32.7 5.834 20.585A3.9 3.9 0 0 1 9.94 16.11c1.225-.01 29.462 0 29.462 0l.285 1.511a.919.919 0 0 0 .9.747h46.789a.923.923 0 0 0 .914-.794l.2-1.464s27.141-.021 27.805 0a5.829 5.829 0 0 1 5.729 6.053z"
            ></path>
            <path
                class="b"
                d="M68.007 34.976h19.177a.4.4 0 0 0 0-.8H68.007a.4.4 0 0 0 0 .8zm.693 3.302a.4.4 0 0 0 0 .8c6.25-.016 12.521.093 18.761-.327.509-.036.514-.831 0-.8-6.237.42-12.508.319-18.761.327zM87.537 41.4c-6.228.349-12.7 1.163-18.907.374-.509-.063-.5.732 0 .8 6.214.784 12.682-.057 18.907-.374.509-.029.514-.826 0-.8zm-19.53 11.112h19.177a.4.4 0 0 0 0-.8H68.007a.4.4 0 0 0 0 .8zm.693 4.097c6.25-.008 12.521.093 18.761-.327.509-.037.514-.831 0-.8-6.24.421-12.511.312-18.761.327a.4.4 0 0 0 0 .8zm18.837 2.325c-6.23.319-12.7 1.163-18.907.374-.509-.062-.5.732 0 .8 6.214.784 12.682-.057 18.907-.374.509-.026.514-.826 0-.8zm11.157 24.312c-48.887 1.429-61.47 1.932-76.294.836-.514-.037-.509.758 0 .8 19.41 1.432 34.8.342 76.294-.836.514-.021.514-.815 0-.8zm0 3.187c-48.887 1.429-61.47 1.932-76.294.836-.514-.036-.509.758 0 .8 19.41 1.432 34.8.342 76.294-.836.514-.016.514-.815 0-.8zM68.007 69.779h19.177a.4.4 0 0 0 0-.8H68.007a.4.4 0 0 0 0 .8zm.693 4.102c6.25-.008 12.521.093 18.761-.327.509-.037.514-.831 0-.8-6.24.421-12.511.312-18.761.327a.4.4 0 0 0 0 .8zm-.075 3.493c6.215.777 12.682-.057 18.907-.373.509-.026.514-.826 0-.8-6.23.322-12.7 1.163-18.907.374-.504-.062-.504.737 0 .799z"
            ></path>
            <path
                class="c"
                d="M91.181 59.37c.2 1.288.395 2.57.592 3.858q5.412-1.706 10.819-3.416c-.244-.976-.483-1.947-.727-2.923q-5.341 1.237-10.684 2.481zm48.319-.337a48.484 48.484 0 0 0-1.416-.426 22.29 22.29 0 0 0-5.545 2.217 31.063 31.063 0 0 0 6.421 4.968 14.576 14.576 0 0 1 2.191-3.109 6.521 6.521 0 0 1-1.651-3.65zm31.718 51.193a19.623 19.623 0 0 0 8.566-4.766c-.566-1.261-1.137-2.518-1.7-3.779l-10.689 7.667a3.675 3.675 0 0 0 3.823.878z"
            ></path>
            <path
                class="c"
                d="M166.582 108.954c13.408-9.6 11.258-8.129 11.489-8.233-17.23-34.8-15.869-32.289-17.033-33.859a22.089 22.089 0 0 0-6.957-6.1.412.412 0 0 1-.109.332 32.016 32.016 0 0 1-7.227 5.586.4.4 0 0 1-.545-.146 16.061 16.061 0 0 0-2.257-3.338 2.3 2.3 0 0 1-.151.146c1.469 1.734 1.339 5.1 1.646 7.823.378 3.349.674 6.749 1.375 10.051.343 1.625 1.23 3.525 1.095 5.207a13.377 13.377 0 0 1-1.51 4.008c-.42.945-2.767 6.577-3.93 6.422-1.075-.146-2.71-3.941-3.136-4.694-1.819-3.214-2.489-3.261-1.651-9.131a98.864 98.864 0 0 1 2.383-11.375c.691-2.585 1.054-5.633 1.937-8.239a4.141 4.141 0 0 1-.286-.207 15.813 15.813 0 0 0-2.247 3.327.409.409 0 0 1-.546.146 31.864 31.864 0 0 1-7.086-5.446 22.244 22.244 0 0 0-5.716 5.041c-4.273 5.361-11.382 5.835-15.725 2.611a21.555 21.555 0 0 1-7.169-8.457c-.056.02-11.721 3.7-11.686 3.7 1.017 4.968 3.218 12.4 7.7 16.716 5.866 5.648 17.23 6.853 22.635 5.654.378 4.132 1.017 8.28 1.6 12.35.395 2.728 1.149 11.607 1.474 13.747.1-.025 35.912-.005 35.811-.005.036-1.08.649-20.382.919-28.958.016-.514.815-.514.8 0-.036 1.21-.446 14.141-.612 19.4a21.658 21.658 0 0 0 4.542 6.214.345.345 0 0 1 .173-.293z"
            ></path>
            <path
                class="c"
                d="M144.414 62.573a14.173 14.173 0 0 1 2.28 3.209 30.948 30.948 0 0 0 6.484-5.031 18.52 18.52 0 0 0-.436-.68 22.287 22.287 0 0 0-4.694-1.609q-1.065.3-2.117.628a22 22 0 0 1-1.517 3.483z"
            ></path>
            <path
                class="d"
                d="M132.8 42.732s-3.8-9.584-1.543-15.055a1.958 1.958 0 0 1 3.676.176l1.1 3.546s2.082-4.626 3.468-3.93 1.158 3.468 1.158 3.468 8.555-3.468 11.333.233-.924 12.024-.924 12.024-1.038-7.055-7.979-7.517-10.289 7.055-10.289 7.055z"
            ></path>
            <path
                class="e"
                d="M151.615 40.951a10.6 10.6 0 0 0-19.234.13 2.544 2.544 0 1 0-.322 4.792 9.713 9.713 0 0 0 7.834 7.06v6.214h5.549v-6.541a9.552 9.552 0 0 0 6.521-6.65 2.542 2.542 0 1 0-.348-5.005z"
            ></path>
            <path
                class="d"
                d="M148.2 48.167c-3.773 0-3.463-2.544-6.484-2.544-3.038 0-2.682 2.544-6.484 2.544a6.88 6.88 0 0 1-2.621-.514c3.592 7.405 15.426 7.283 18.782-.275a6.739 6.739 0 0 1-3.193.789z"
            ></path>
            <path
                class="b"
                d="M136.882 42.27a.7.7 0 1 1-.7.7.695.695 0 0 1 .7-.7zm10.409 0a.7.7 0 1 1-.7.7.7.7 0 0 1 .7-.7zm-8.219-2.928a4.2 4.2 0 0 0-4.615 2.035.4.4 0 0 0 .691.4 3.386 3.386 0 0 1 3.712-1.666c.498.118.711-.65.212-.769zm6.241.768a3.383 3.383 0 0 1 3.712 1.666.4.4 0 0 0 .69-.4 4.2 4.2 0 0 0-4.615-2.035c-.493.12-.286.888.213.769zm-5.706.659c.013 1.521.623 4.242 2.622 4.133 1.666-.094 2.03-2.627 2.108-3.9.031-.514-.763-.509-.8 0-.052.815-.259 2.959-1.308 3.1-1.454.2-1.817-2.357-1.822-3.338a.4.4 0 0 0-.8.005zm.281 6.915 4.49.073s-.187 1.854-2.544 1.791-1.946-1.864-1.946-1.864z"
            ></path>
            <path
                d="M161.126 113.086h-36.133c.476 11.065 1.761 29.895 2.882 39.954.964 8.656.857 20.859 6.162 21.58 4.752.649 5.334-9.544 6.318-14.115 2.012-9.405 3.757-20.756 5.056-30.287.167-1.236.805-3.136.571-4.381 0 0 8.769 47.553 17.267 47.553s-2.123-60.304-2.123-60.304z"
                style="fill: #6c458f"
            ></path>
            <path
                class="b"
                d="M132.376 176.069a8.467 8.467 0 0 0 3.483-.218 1.818 1.818 0 0 1 2.321 1.355c.332 1.583.566 3.551-.13 4.153-1.137 1-10.144 3.707-15.232 2.871a1.146 1.146 0 0 1 .088-2.274c1.963-.145 6.277-.9 7.476-4.667a1.828 1.828 0 0 1 1.994-1.22zm34.388-.732a8.47 8.47 0 0 1-3.483.27 1.814 1.814 0 0 0-2.109 1.661c-.108 1.615-.062 3.593.707 4.1 1.266.826 10.559 2.259 15.48.722a1.15 1.15 0 0 0 .79-1.329 1.137 1.137 0 0 0-1.189-.9c-1.963.129-6.344-.016-8.057-3.583a1.826 1.826 0 0 0-2.139-.941z"
            ></path>
            <path
                class="e"
                d="M98.47 55.155c.748-.909.712-2.482.748-3.582a13.383 13.383 0 0 0-.561-3.868 16.682 16.682 0 0 0-2.232-5.425c-.379-.529-2.1-3.141-2.923-2.243-.488.535.286 2.067.441 2.638.182.675.478 1.36.6 2.024-.307-.908-2.238-1.391-3.017-.96a4.015 4.015 0 0 0-1.8 1.968c-1.547-.405-1.267 3.405-1.038 4.148.373 1.2 1.469 2.481 2.855 1.718-.363.2.42 2.855.633 3.245 1.043 2.142 5.063 1.834 6.294.337zm81.262 55.045c-1.884-.863-3.894-.914-5.165 1.1-.945 1.495-.919 3.712-.9 5.42.017 1.163-.1 3.213.52 4.251.877 1.465 1.4-.679 1.6-1.489.155-.618.389-2.466 1.22-2.492 1.308-.036 1.739 4.776 1.921 5.721.119.617.244 3.7 1.371 2.746s-.006-3.343.41-4.506c.747-2.1 1.842 2.082 2.538 2.492 1.869 1.111.447-3.343.556-4.262 1.437-.374 1.541 3.058 3.317 2.575.363-1.225-.5-2.679-.914-3.837a17.338 17.338 0 0 0-2.191-4.148 11.5 11.5 0 0 0-4.283-3.571z"
            ></path>
            <circle class="a" cx="57.203" cy="72.494" r="5.358"></circle>
            <path
                class="g"
                d="M38.1 40.489c1.028-1.63 2.674-2.809 3.515-4.574a6.383 6.383 0 0 0-.54-5.923 10.376 10.376 0 0 0-8.156-5.347c-7.8-.727-13.473 4.163-10.212 11.587.992 2.258 2.923 4.112 4.475 6.09a26.9 26.9 0 0 1 2.118 4.329h6.578c-.001.149.886-4.038 2.222-6.162z"
            ></path>
            <path
                class="b"
                d="M36.863 37.66a1.17 1.17 0 0 0-1.983-.478 2.639 2.639 0 0 0-.633 1.106c-.166.483-.312.971-.431 1.469a2.3 2.3 0 0 1-1.1-.343 2.842 2.842 0 0 0 .7-2.232 1.118 1.118 0 0 0-2.165-.405 3.3 3.3 0 0 0 .343 2.57 1.95 1.95 0 0 1-1.433.311c-.331-1.206-.6-2.491-1.578-3.047a.916.916 0 0 0-.556-.135c-1.3.136-.756 3.039 1.485 3.831A57.876 57.876 0 0 1 30.7 45.93a.4.4 0 0 0 .784-.13 60.435 60.435 0 0 0-1.116-5.321 2.778 2.778 0 0 0 1.744-.525 2.96 2.96 0 0 0 1.537.577 15.148 15.148 0 0 0-.036 5.258.4.4 0 0 0 .789-.135 14.447 14.447 0 0 1 .057-5.113c1.878-.161 2.814-1.641 2.404-2.881zm-8.726-.369c.634.317.9 1.3 1.079 1.994a2.266 2.266 0 0 1-1.079-1.994zm4.054 1.5a2.59 2.59 0 0 1-.223-1.671.473.473 0 0 1 .374-.265c.178 0 .254.269.28.446a2.022 2.022 0 0 1-.431 1.49zm2.45.94c.1-.4.218-.789.353-1.178.146-.407.353-.94.79-.94.563 0 .688 1.8-1.143 2.118zm-5.113 8.54H35.4a.3.3 0 0 0 0-.6h-5.872a.3.3 0 0 0 0 .6zm0 1.594H35.4a.3.3 0 0 0 0-.6h-5.872a.3.3 0 0 0 0 .6zm74.612-28.237a1.2 1.2 0 0 1-1.605 1.194 1.326 1.326 0 0 1-.582-1.952 1.233 1.233 0 0 1 2.187.758c.02.509.819.517.8 0a2.007 2.007 0 0 0-3.873-.745 2.089 2.089 0 0 0 1.593 2.777 1.991 1.991 0 0 0 2.28-2.032.4.4 0 0 0-.8 0z"
            ></path>
            <path
                class="h"
                d="M112.243 21.628a1.548 1.548 0 0 1-1.6 1.656 1.631 1.631 0 0 1-1.588-1.9 1.6 1.6 0 0 1 3.188.244z"
            ></path>
            <path
                class="b"
                d="M110.956 19.64a1.949 1.949 0 0 0-2.186 1.246 2.089 2.089 0 0 0 1.594 2.777 2 2 0 0 0 2.276-1.963 2.04 2.04 0 0 0-1.684-2.06zm-.717 3.182a1.325 1.325 0 0 1-.581-1.952 1.232 1.232 0 0 1 2.186.758 1.2 1.2 0 0 1-1.605 1.194zM36.438 54.231a8.6 8.6 0 0 0-8 .223 8.444 8.444 0 0 0 4.568 15.455c8.753-.174 10.648-12.172 3.432-15.678zM34.257 69a7.393 7.393 0 0 1-8.6-5.9 7.551 7.551 0 0 1 2.99-7.839 7.457 7.457 0 0 1 11.442 6.286c-.023 3.596-2.136 6.824-5.832 7.453z"
            ></path>
            <circle class="b" cx="28.292" cy="59.952" r=".929"></circle>
            <circle class="b" cx="37.19" cy="60.082" r=".929"></circle>
            <path
                class="b"
                d="M35.6 63.139a2.792 2.792 0 0 1-5.581 0c-.026-.509-.826-.514-.8 0a3.588 3.588 0 1 0 7.175 0c.028-.514-.771-.514-.794 0z"
            ></path>
            <path
                class="g"
                d="m51.934 42.15 6.375-13.285a19.154 19.154 0 0 1 3.385 6.329c.213.566 1.729 5.679 2.191 5.627z"
            ></path>
            <path
                class="h"
                d="m50.64 54.108 7.14-7.14 7.139 7.14-7.14 7.14z"
            ></path>
            <path
                class="g"
                d="M106.05 39.705a.772.772 0 0 0 .94.062c2.766-1.867 7.4-3.834 7.512-7.937a4.511 4.511 0 0 0-3.095-4.444 4.144 4.144 0 0 0-3.955 1.1.765.765 0 0 1-1.184-.026 4.178 4.178 0 0 0-7.637 2.669 6.721 6.721 0 0 0 2.6 5.129c1.377 1.132 3.42 2.235 4.819 3.447z"
            ></path>
            <path
                class="b"
                d="M138.9 66.727a.4.4 0 0 0 .545-.146 15.931 15.931 0 0 1 2.248-3.328 2.524 2.524 0 0 0 .285.208c-.882 2.606-1.246 5.654-1.937 8.239-.93 3.476-3.135 12.787-2.663 16.358.208 1.584 1.158 2.772 1.931 4.148.426.753 2.062 4.548 3.136 4.693 1.168.156 3.51-5.477 3.93-6.422a13.589 13.589 0 0 0 1.511-4.007c.13-1.682-.753-3.582-1.1-5.207-.7-3.3-1-6.7-1.375-10.051-.313-2.773-.17-6.085-1.646-7.824a2.059 2.059 0 0 0 .151-.145 15.76 15.76 0 0 1 2.258 3.338.408.408 0 0 0 .545.146 31.868 31.868 0 0 0 7.226-5.586.407.407 0 0 0 .062-.483c-.8-1.293-2.139-3.588-3.924-3.458a17.62 17.62 0 0 0-4.574 1.168 23.254 23.254 0 0 0-5.4 0 17.186 17.186 0 0 0-4.569-1.168c-1.791-.13-3.119 2.16-3.924 3.458a.407.407 0 0 0 .062.483 31.891 31.891 0 0 0 7.222 5.586zm14.26-5.929a31.355 31.355 0 0 1-6.484 5.03 14.582 14.582 0 0 0-2.276-3.208 21.832 21.832 0 0 0 1.521-3.473 59.65 59.65 0 0 1 2.347-.7c2.589-.715 3.437.006 4.894 2.353zm-13.68-1.724a6.394 6.394 0 0 0 1.657 3.645 14.564 14.564 0 0 0-2.191 3.109 31.069 31.069 0 0 1-6.484-5.025c2.138-3.42 3.138-2.957 7.02-1.729zm-36.955-2.73a.394.394 0 0 0-.489-.281q-5.715 1.337-11.425 2.658a.408.408 0 0 0-.281.488q.359 2.337.722 4.678a.4.4 0 0 0 .488.28q5.809-1.838 11.613-3.67a.41.41 0 0 0 .28-.488c-.301-1.22-.613-2.439-.908-3.665zm-.675.581c.244.976.483 1.947.726 2.923q-5.412 1.706-10.818 3.416c-.2-1.288-.395-2.57-.592-3.857q5.342-1.231 10.684-2.482zm78.739 48.475c-2.168-4.729-1.988-4.639-2.264-4.683-.234-.083.49-.5-11.764 8.275a.411.411 0 0 0-.083.628 4.379 4.379 0 0 0 3.265 1.667c3.656-.2 8.134-2.785 10.778-5.4a.4.4 0 0 0 .068-.487zm-9.386 4.869a3.684 3.684 0 0 1-3.826-.877l10.689-7.668c.566 1.262 1.137 2.518 1.7 3.78a19.612 19.612 0 0 1-8.566 4.763zm-9.553-26.587c-.265 8.576-.882 27.883-.919 28.958h-35.748a.4.4 0 0 0 0 .8h36.133a.409.409 0 0 0 .4-.4c.27-8.577.893-28.148.929-29.358.02-.514-.779-.514-.795 0zM96.269 45.379a2.435 2.435 0 0 0-.867 1.475c-.093-.519-.218-1-.306-1.355-.12-.5-.888-.286-.769.213.141.591.779 3.68-.342 3.649-1.288-1.287-1.506-3.478-1.4-5.217.031-.514-.768-.509-.8 0a8.192 8.192 0 0 0 1.225 5.316.35.35 0 0 0-.026.13c-.042.887-.519 1.578-1.459 1.458-.509-.062-.5.738 0 .8a1.962 1.962 0 0 0 2.191-1.739c.7 0 .805-.021 1.075-.208.51-.349.1-.737.192 2.471.015.514.815.514.8 0a18.938 18.938 0 0 1 .405-5.108c.12-.483.457-1.916 1.267-.846a3.382 3.382 0 0 1 .208 1.105c.233 1.428.379 2.871.513 4.314.047.509.847.509.8 0-.106-.95-.143-8.148-2.707-6.458zm51.67 137.091a.629.629 0 1 1-.628.628.629.629 0 0 1 .628-.628z"
            ></path>
            <path
                class="b"
                d="M149.575 73.148a.315.315 0 0 0-.239.156c-.413.2-.279.4.255 7.928a.407.407 0 0 0 .29.384c4.04.872 3.775.986 4.553.991.476 0 .442-.087 3.551-1.63a.393.393 0 0 0 .2-.342c.021-1.672.047-3.339.068-5.01a2.839 2.839 0 0 0-1.064-2.83c-.924-.41-2.414-.124-3.4-.083a32.545 32.545 0 0 0-4.214.436zm4.973 8.681c-.317-.033 1.019.226-4.184-.914l-.3-4.309c1.271.808 3.288-.31 5.8-.119a4.8 4.8 0 0 0 1.588.005c-.01.716-.02 1.433-.026 2.144a6.666 6.666 0 0 0-.052 1.76 7.093 7.093 0 0 0-.711.368 14.93 14.93 0 0 0-2.115 1.065zm2.575-8.063c.332.349.54 1.662.052 1.957-.353.218-1.168-.041-1.557-.062-3.418-.161-5.912 1.839-5.718-1.761a33.229 33.229 0 0 1 4.818-.42c.604-.01 1.922-.222 2.405.286z"
            ></path>
          </g>
        </g>
      </svg>

      <h3>Personalizing {{ name ? "for " + name : "" }}...</h3>
      <div class="step-progress">
        <div class="bar progressbar" :style="{ width: progress + '%' }"></div>
      </div>

      <div v-if="listIngredients && listIngredients.length > 0">
        <ul class="list-anwser">
          <transition-group name="fadeRight" tag="ul">
            <li  v-for="(item, key) in listIngredients" :key="key+'1'" style="animation-duration: 0.3s">
              <img :src="item.image" alt="" />
              <span>{{ item.ConsumerTitle }}</span>
            </li>
          </transition-group>
        </ul>
      </div>
    </div>
    <div class="wrap-content-form">
      <div class="step-body">
        <form>
          <slot></slot>
        </form>
      </div>
      <div class="step-footer">
        <div class="btn-group" role="group">
          <template v-if="!submitSuccess">
            <!-- <button
              @click="previousTab"
              v-if="currentTab !== 0"
              :disabled="currentTab === 0"
              class="step-button step-button-previous"
            >
              Previous
            </button> -->
            <button
                @click="nextTab"
                v-if="currentTab < totalTabs - 1 && isShowNext"
                class="step-button step-button-next"
            >
              Next
            </button>
            <button
                @click="onSubmit"
                v-if="currentTab === totalTabs - 1"
                class="step-button step-button-submit"
            >
              Submit
            </button>
          </template>
          <!-- <template v-else>
            <button @click="reset" class="step-button step-button-reset">
              Reset
            </button>
          </template> -->
        </div>
      </div>
    </div>
  </div>
</template>
<script>
import TabContent from "./TabContent.vue"
import { store } from "../../store/form_store.js";
export default {
  name: "form-wizard",
  components: {
    TabContent,
  },
  props: {
    name: {
      type: String,
    },
    data: {
      type: Array,
    },
    isShowNext: {
      type: Boolean
    },
    ingredients: {
      type: Array
    }
  },
  data() {
    return {
      tabs: [],
      currentTab: 0,
      totalTabs: 0,
      storeState: store.state,
      submitSuccess: false,
      progress: 0,
      isValidationSupport: false,
    };
  },
  mounted() {
    this.tabs = this.$slots.default().filter(child => child.type.name === 'tab-content')
    console.log(this.$slots.default())
    this.totalTabs = this.tabs.length;
    this.currentTab = this.tabs.findIndex((tab) => tab.isActive === true);
    //Select first tab if none is marked selected
    if (this.currentTab === -1 && this.totalTabs > 0) {
      this.tabs[0].isActive = true;
      this.currentTab = 0;
    }

    //Setup Initial Progress
    this.progress = ((this.currentTab + 1) / this.totalTabs) * 100;
  },
  updated() {
    /*
          Using this lifehook - since store variable gets updated after component is mounted
          isValidationSupport checks if user is looking to perform validation on each step
        */
    this.isValidationSupport =
        Object.keys(this.storeState.v).length !== 0 &&
        this.storeState.v.constructor === Object
            ? true
            : false;
  },
  methods: {
    previousTab() {
      this._switchTab(this.currentTab - 1);
      this.$emit("onPreviousStep");
    },
    nextTab() {
      if (this._validateCurrentTab() === false) return;
      this.$emit("onNextStep");
    },
    triggerNext(tab = null) {
      if (tab) {
        this.currentTab = tab;
        this._switchTab(this.currentTab);
      } else {
        this._switchTab(this.currentTab + 1);
      }
    },
    reset() {
      this.tabs.forEach((tab) => {
        tab.isActive = false;
        tab.isValidated = false;
      });
      this._switchTab(0);
      this.submitSuccess = false;
      this.storeState.v.$reset();
      this.$emit("onReset");
    },
    changeStatus() {
      this.submitSuccess = true;
    },
    selectTab(index) {
      //Only switch to filled previous tabs
      if (index < this.currentTab) {
        this._switchTab(index);
        return;
      }
      if (this._validateCurrentTab() === false) {
        return;
      }
      if (this.tabs[index - 1].isValidated === false) {
        return;
      }
      this._switchTab(index);
    },
    onSubmit() {
      if (this._validateCurrentTab() === false) return;
      this.$emit("onComplete");
    },
    _switchTab(index) {
      //Disable all tabs
      this.tabs.forEach((tab) => {
        tab.isActive = false;
      });
      this.currentTab = index;
      this.tabs[index].isActive = true;
      this.progress = ((this.currentTab + 1) / this.totalTabs) * 100;
      this.$emit("afterChangeTab");
    },
    _validateCurrentTab() {
      if (!this.isValidationSupport)
          //Check if user wants to validate
        return true;
      this.storeState.v.$touch();
      if (this.storeState.v.$invalid) {
        this.tabs[this.currentTab].isValidated = false;
        return false;
      }
      this.tabs[this.currentTab].isValidated = true;
      return true;
    },
  },
  watch: {
    currentTab() {
      store.setCurrentTab(this.currentTab);
    },
  },
};
</script>

